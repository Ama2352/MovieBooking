# üí• K6 Load Test Report: Soak Test (Critical Endurance Failure)

## üìÑ Test Scenario Overview

| Attribute | Detail |
| :--- | :--- |
| **Test Script** | `05-soak-test.js` (Endurance Test) |
| **Test Purpose** | To validate the system's **long-term stability** (20 minutes) under **constant, moderate load** (15 VUs), looking for resource leaks or gradual degradation. |
| **Critical Flow** | Mixed Operations: 85% Reads (Seat Map, Movies, Availability) / 15% Writes (Lock/Release Seat). |
| **Duration** | **20 minutes**. |
| **Key Failure Indication** | Gradual increase in error rate or latency over the test duration. |

---

## ‚öôÔ∏è Load Profile (Setup Scenario)

The test used a **Constant VUs** executor to maintain a steady, moderate load throughout the 20-minute duration.

| Attribute | Setting | Description |
| :--- | :--- | :--- |
| **Executor** | `constant-vus` | Maintains stable load for endurance testing. |
| **Virtual Users (VUs)** | **15 VUs** | Constant, moderate load level. |
| **Operation Mix** | Read-heavy (85%) to simulate browsing traffic, Write (15%) to stress transactional components. |

---

## üö¶ Threshold Assessment Summary

The test **FAILED CATASTROPHICALLY** on **all stability and latency thresholds**. The system proved highly unstable, even under moderate load, with performance degrading rapidly into multi-second and multi-minute response times. This is the classic sign of a **memory leak or connection pool exhaustion** .

| Metric | Threshold | Actual Result | Status | Key Insight |
| :--- | :--- | :--- | :--- | :--- |
| **`soak_write_latency` p(99)** | $< 4000$ ms | **$57879.06$ ms (57.8s)** | ‚ùå **CRITICAL FAIL** | Write operations are *horrifically* slow, indicating severe resource starvation (DB or application threads). |
| **`soak_read_latency` p(99)** | $< 2000$ ms | **$10008.24$ ms (10.0s)** | ‚ùå **CRITICAL FAIL** | Even simple read operations are taking 10+ seconds. |
| **`soak_iteration_latency` p(99)** | $< 5000$ ms | **$42276.56$ ms (42.2s)** | ‚ùå **CRITICAL FAIL** | Overall user experience is broken, with near-minute latencies. |
| **`soak_errors`** | Count $< 100$ | **$1091$** | ‚ùå **CRITICAL FAIL** | Over 10x the allowed number of functional errors. |
| **`soak_success_rate`** | Rate $> 95\%$ | $66.58\%$ | ‚ùå **FAIL** | $33.42\%$ of all iterations resulted in a functional error. |

---

## üìä Detailed Metric Analysis

### 1. Latency Degradation (The Smoking Gun)

The latency figures confirm a severe, time-based performance issue‚Äîthe exact scenario a soak test is designed to find.

| Metric | Average (Avg) | P99 Result | Insight |
| :--- | :--- | :--- | :--- |
| **Overall HTTP Duration** | $1.93$ s | **$1$ minute** (Max) | The maximum time taken for any single request was 1 minute (the timeout of k6's HTTP client), confirming the system became completely unresponsive for many requests. |
| **Write Latency p(99)**| $7.49$ s | **$57.8$ s** | Requests involving the database or Redis (Lock/Release) are catastrophically slow, indicating **database connection pool exhaustion** or thread starvation in the application server. |
| **Read Latency p(99)** | $1.63$ s | **$10.0$ s** | Even simple reads are affected, showing that the overall application server resources (CPU/threads) are bottlenecked. |

### 2. Functional Failure and Checks

The functional breakdown is confirmed by the custom metrics and check failures.

* **`soak_errors`: 1091 (FAIL)**
    * $1091$ iterations resulted in a failure of a crucial check.
* **Check Failure Breakdown:**
    * **`soak availability: status 200`** $\rightarrow$ **$0\% \checkmark$**
        * This endpoint failed **679 times**. This single check's failure ($0\%$ success) is highly correlated with the functional failure in the previous soak test, indicating this endpoint is prone to crashing or returning incorrect status codes when resources are exhausted.
    * **`soak seatmap: status 200`** $\rightarrow$ **$79\% \checkmark$**
        * Even the most common, simple read operation failed **$21\%$** of the time (261 times), confirming that stability degraded across the entire read layer.

### 3. Stability Metrics

* **`http_req_failed` rate: $25.82\%$ (FAIL)**
    * While this is close to the threshold, the fact that $25.82\%$ of all requests resulted in an unexpected failure status code (likely 5xx or uncaught timeouts) *in addition* to the massive latency confirms the system's brittleness. The errors are **climbing** as latency degrades.

---

## üõë Overall Test Conclusion

The **Soak Test FAILED CRITICALLY**. The system is **not ready for production usage** as it cannot maintain stability or performance under sustained, moderate load. The multi-second and multi-minute latencies are classic indicators of **resource leakage or saturation**.

### Summary of Findings

1.  **Critical Degradation:** Performance degrades dramatically over the 20-minute period. Latencies ballooned to over 10 seconds (P99 reads) and nearly 60 seconds (P99 writes).
2.  **Primary Cause:** The results strongly suggest **Connection Pool Exhaustion** (Database/Redis) or an **Application Thread Leak/Starvation**. The slow queueing affects all requests, including simple reads.
3.  **Endpoint Failure:** The `/seat-locks/availability` endpoint is confirmed to be a major vulnerability, failing $100\%$ of its attempts during the degradation period.

### Recommended Next Steps

1.  **Immediate Backend Diagnosis:** The highest priority is to review **JVM/Go/Node process metrics** (CPU, Memory/Heap) and **Database/Redis connection pool usage** in a monitoring tool (like Grafana/Prometheus) for the 20-minute test duration. Look for:
    * **Continuously climbing memory usage** (memory leak).
    * **Connection Pool Utilization** hitting $100\%$ and remaining there.
    * **Thread Count** rising uncontrollably.
2.  **Fix and Re-Test:** Fix the underlying resource issue (increase connection pools, resolve memory leak, fix the crashing availability endpoint) and **re-run the soak test** to ensure all latency metrics remain flat and the error rates stay below $1\%$ for the entire 20-minute period.