# ‚ùå K6 Load Test Report: Spike Test (Failed Latency & Recovery)

## üìÑ Test Scenario Overview

| Attribute | Detail |
| :--- | :--- |
| **Test Script** | `04-spike-test.js` (Stress/Spike Test) |
| **Test Purpose** | To assess the system's **stability and recovery time** under a sudden, massive surge in traffic (a 10x spike from 10 VUs to 100 VUs). |
| **Critical Flow** | Get Seats $\rightarrow$ **Attempt to Lock Single Seat** $\rightarrow$ Release Lock |
| **Key Metric** | **Recovery Speed:** How fast does latency return to baseline after the peak load drops? |

---

## ‚öôÔ∏è Load Profile (Setup Scenario)

The test employed a sharp **Spike Pattern** (10 $\rightarrow$ 100 VUs) followed by a return to baseline (Recovery Phase).

| Phase | Duration | Target Virtual Users (VUs) | Goal |
| :--- | :--- | :--- | :--- |
| **1: Baseline** | 30s | 10 | Establish normal performance. |
| **2: SPIKE!** | **40s** | **100 VUs** | Sudden 10x load increase. |
| **3: Drop** | 5s | 10 | Quick return to low load. |
| **4: Recovery** | **30s** | 10 | Monitor recovery time. |

---

## üö¶ Threshold Assessment Summary

The test **FAILED** due to **critical latency degradation** during the spike and **poor recovery time**. The system broke under the sudden load, leading to massive performance slowdowns, although it narrowly avoided a complete crash (passing the error rate threshold). 

| Metric | Threshold | Actual Result | Status | Key Insight |
| :--- | :--- | :--- | :--- | :--- |
| **`spike_latency` p(95)** | $< 5000$ ms | **$10002.85$ ms** | ‚ùå **FAIL** | Latency during the spike phase more than **doubled** the acceptable limit. |
| **`http_req_duration` p(99)** | $< 8000$ ms | **$19.33$ s** | ‚ùå **FAIL** | $1\%$ of requests took nearly **20 seconds**, indicating a severe bottleneck or timeout cascade. |
| **`spike_success_rate`** | Rate $> 50\%$ | **$49.86\%$** | ‚ùå **FAIL** | Just under the pass mark. Half of all attempts failed due to contention or errors. |
| **`http_req_failed`** | Rate $< 25\%$ | $24.75\%$ | ‚úÖ **PASS** | **Trivial Pass.** The system technically passed this threshold, but the high latency suggests many requests failed due to **client-side timeouts** (which k6 wouldn't count in this metric) or slow 5xx errors. |

---

## üìä Detailed Metric Analysis

### 1. Latency and Recovery (The Critical Failure)

The system failed to handle the sudden surge gracefully; instead of quickly returning expected conflicts, the requests slowed drastically.

| Metric | Average | P95 Result | Max Result | Insight |
| :--- | :--- | :--- | :--- | :--- |
| **`spike_latency`** | $5100.86$ ms | **$10002.85$ ms (10.00s)** | $19.50$ s | The average time for the primary action exceeded the 5-second P95 threshold. The **10-second P95** and **20-second max** times indicate severe **thread queuing, connection pool starvation, or a cascading timeout issue** in the backend during the spike phase. |
| **`http_req_duration` p(99)** | $2.87$ s (Avg) | **$19.33$ s** | $19.52$ s | The near-20-second maximum latency strongly suggests that multiple application threads or database connections were blocked or hung during the peak of the spike and took significant time to clear, indicating **poor recovery** after the load dropped. |
| **`iteration_duration` p(95)** | $6.56$ s (Avg) | $18.27$ s | $20.88$ s | Total iteration time also ballooned, confirming that the entire user experience was critically degraded. |

### 2. Success and Stability Metrics

| Metric | Result | Meaning of Result | Code Line/Logic |
| :--- | :--- | :--- | :--- |
| **`spike_success_rate`** | **$49.86\%$** | **FAIL.** This indicates that for nearly half the user base (373 attempts), the system could not either grant the lock or return a quick, graceful conflict response. | Line 310: `spikeSuccessRate.add(1);` Line 328: `spikeSuccessRate.add(0);` |
| **`http_req_failed`** | $24.75\%$ | **Trivial Pass.** The result is right on the $25\%$ limit. Given the massive latency, it's highly probable that requests started failing due to k6's internal timeouts *before* the system returned a 5xx error, thus suppressing the true error rate. | Tracks overall unexpected HTTP errors. |
| **`spike_failures`** | **368** | Total attempts that resulted in an unexpected failure or failed the primary check, confirming the business impact of the latency. | Line 275, 327. |

---

## üõë Overall Test Conclusion

The **Spike Test FAILED** due to a complete breakdown in performance and recovery during the high-load phase.

The system demonstrates **poor elasticity** and is **not resilient** to sudden traffic surges. When overwhelmed, the system stops processing requests quickly, leading to queuing and timeouts that last for several seconds, severely degrading the user experience (10 seconds or more for $95\%$ of users).

### Recommended Next Steps

1.  **Identify Bottleneck:** The extreme jump in latency suggests a severe resource bottleneck. Investigate the **Database Connection Pool size** and the **Application Thread Pool configuration**. These are the most common causes of multi-second latency spikes in transactional systems.
2.  **Apply Circuit Breakers:** Implement **circuit breaker** or **rate limiting** mechanisms to shed load quickly during spikes. This would force requests to fail fast with a controlled **429 Too Many Requests** rather than allowing requests to queue for 10-20 seconds.
3.  **Re-Test:** Re-run the test after increasing resource limits (pools/threads) and/or implementing fast-fail mechanisms, targeting a `spike_latency` P95 below $500$ ms (not $5000$ ms).